<%- cache ["shared/nav", Customer.cache_key, (@current_user.cache_key if @current_user), Date.today.to_s].join("/") do -%>

<nav class="navbar navbar-inverse navbar-static-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-nav" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
			<%= link_to image_tag('dreamsis-logo-transp-2x.png', alt: "DreamSIS"), root_url, class: "navbar-brand" %>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="top-nav">
      <ul class="nav navbar-nav">
				
				<%- if @current_user && @current_user.display_navbar? -%>
				
					<%= nav_dropdown("My #{Customer.mentees_label}") do %>
						<li><%= link_to "All my #{Customer.mentees_label}", my_participants_url, glyph: 'graduation-cap' %></li>
						<%- if Customer.uses_activity_logs? -%>
							<li><%= link_to "Track my week", my_current_activity_log_url, glyph: "calendar-check-o" %></li>
						<% end %>
            
						<li role="separator" class="divider"></li>
						<%- for participant in @current_user.participants -%>
							<li class="participant">
								<%= content_tag :div, nil, class: "avatar", style: "background-image: url(#{participant.avatar.thumb.url})" %>
								<%= link_to truncate(participant.fullname), participant %>
							</li>
						<% end %>
					<% end %>

					<%= nav_dropdown(Customer.participants_Label) do %>
						<li><%= link_to "All #{Customer.participants_Label}", participants_url, glyph: 'list' %></li>
						<li><%= link_to "Add new #{Customer.participant_label}", new_participant_url, glyph: 'plus-square' %></li>
						<%- if Customer.uses_clearinghouse? && @current_user.admin? -%>
							<li><%= link_to "National Student Clearinghouse&reg; Requests".html_safe, clearinghouse_requests_url %></li>
						<% end %>
					
						<li role="separator" class="divider"></li>
            <h4>Cohorts</h4>
						<% for cohort in Participant.cohorts %>
							<li><%= link_to "#{cohort.to_s} Cohort", cohort_url(cohort) %></li>
						<% end -%>
					<% end %>

					<%= nav_dropdown(Customer.mentors_Label) do %>
						<li><%= link_to "All #{Customer.mentors_Label}", mentors_url, glyph: 'list' %></li>
						<li><%= link_to "Add new #{Customer.mentor_label}", new_mentor_url, glyph: 'plus-square' %></li>
						<li><%= link_to "#{Customer.mentor_Label} Groups", mentor_term_groups_url, glyph: 'users' %></li>
					
						<li role="separator" class="divider"></li>
						<li><%= link_to "On-boarding", onboarding_mentors_url(term_id: Term.current_term) %></li>
						<li><%= link_to "Event Status", event_status_mentors_url(term_id: Term.current_term) %></li>
						<li><%= link_to Customer.leads_Label, leads_mentors_url(term_id: Term.current_term) %></li>
						<li><%= link_to "Drivers", van_drivers_mentors_url %></li>
					<% end %>

					<%= nav_dropdown("High Schools") do %>
						<li><%= link_to "Partner High Schools", high_schools_url, glyph: 'list' %></li>
						<li><%= link_to "Current Stats", stats_high_schools_url, glyph: 'pie-chart' %></li>
						
						<li role="separator" class="divider"></li>
						<% for high_school in HighSchool.partners %>
							<li class="admin"><%= link_to "#{high_school.name}", high_school_url(high_school) %></li>
						<% end -%>
						
						<%- for high_school in @current_user.current_locations -%>
							<li role="separator" class="divider"></li>
							<h3><%= high_school.name %></h3>
							<li><%= link_to "All #{Customer.mentees_label}", high_school_cohort_path(high_school, Participant.current_cohort), glyph: 'list' %></li>
							<li><%= link_to "Take attendance", attendance_high_school_visits_path(high_school, Term.current_term), glyph: 'hand-paper-o' %></li>
							<li><%= link_to "Statistics", stats_high_school_path(high_school), glyph: 'pie-chart' %></li>
						<% end -%>
					<% end %>

					<%= nav_dropdown("Colleges") do %>
						<li><%= link_to "All locations &amp; Colleges".html_safe, locations_url, glyph: 'list' %></li>
						
						<li role="separator" class="divider"></li>
						<% for college in CollegeApplication.top_institutions(10) %>
							<li>
								<%= link_to fetch_favicon_tag(college.try(:formatted_website_url)) + " #{college.name} (#{college.count})", college_url(college.try(:id)), title: college.name %>
							</li>
						<% end -%>
					<% end %>

					<%= nav_dropdown("Events") do %>
						<li><%= link_to "All Events", events_url, glyph: 'list' %></li>
						<li><%= link_to "Add new event", new_event_url, glyph: 'plus-square' %></li>
						
						<li role="separator" class="divider"></li>
						<li><%= link_to Customer.visits_Label, events_url(type: "Visit") %></li>
						<li><%= link_to "Groups", event_groups_url %></li>
						<li><%= link_to "Types", event_types_url %></li>
					<% end %>
					
					<%= nav_dropdown("Other") do %>
						<% if @current_user.admin? && Customer.current_customer %>
							<li>
								<%= link_to "#{Customer.current_customer.name} Settings", [:edit, Customer.current_customer], glyph: 'wrench' %>
							</li>
						<% end %>
						<li><%= link_to "Locations &amp; Colleges".html_safe, locations_url, glyph: 'bank' %></li>
						<li><%= link_to "Participant Groups", participant_groups_url, glyph: 'object-group' %></li>
						<li><%= link_to "Programs", programs_url, glyph: 'graduation-cap' %></li>
						<li><%= link_to "Scholarships", scholarships_url, glyph: 'money' %></li>
						<li><%= link_to "Stat Filters", object_filters_url, glyph: 'line-chart' %></li>
						<li><%= link_to "Terms", terms_url, glyph: 'calendar' %></li>
						<li><%= link_to "Tests", test_types_url, glyph: 'pencil-square-o' %></li>
						<li><%= link_to "Trainings", trainings_url, glyph: 'book' %></li>
						<li><%= link_to "Trashed Records", deleted_records_url, glyph: 'trash-o' %></li>
						<li><%= link_to "Users", users_url, glyph: 'shield' %></li>
					<% end %>
          
				<% end %>
				
			</ul>

			<% unless @current_user.blank? || @current_user == :false %>

				<ul class="nav navbar-nav navbar-right user">

					<li class="dropdown">
						<a href="#" class="dropdown-toggle avatar" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
							<%= image_tag(@current_user.person.avatar_image_url, height: 30, class: "avatar") if @current_user.person && @current_user.person.avatar_image_url %> <span class="caret"></span>
						</a>
						<ul class="dropdown-menu">
							<li>
								<a title="You are logged in as a <%= @current_user.person.type || "generic person" %>">
									<b><%= @current_user.fullname %></b>
								</a>
							</li>
							<%-
								path_hash = {}
								path_hash[:return_to_after_profile] = request.url
								path_hash[:apply_extra_styles] = true if @extra_stylesheet
								path_hash[:apply_extra_footer_content] = true if @extra_footer_content
							 -%>
							<li><%= link_to "Edit Profile", profile_path(path_hash) %></li>
              
              <%- if @current_user.person_type == "Mentor" %>
                <li><%= link_to "My Participation", my_participation_url %></li>
              <% end %>
							
							<li role="separator" class="divider"></li>
							<li><%= link_to "Logout", logout_path, glyph: 'sign-out' unless @current_user.is_a?(PubcookieUser) %></li>
						</ul>
					</li>
				</ul>
        
        <form class="navbar-form navbar-right minimized" id="nav-global-search" action="/search" role="search">
          <%= glyph(:search) %>
          <div class="form-group">
            <input type="text" class="form-control search typeahead global-search" data-action="navigate" name="q" placeholder="Search">
          </div>
        </form>
      
			<% else %>
				<p class="navbar-text navbar-right">
					<%= link_to 'Login', login_path(return_to: request.url), glyph: 'sign-in', class: 'btn btn-success' %>
				</p>
			<% end %>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<% end %>
