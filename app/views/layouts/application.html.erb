<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>DreamSIS<%= " [DEV]" if RAILS_ENV == "development" %></title>

	<meta name="viewport" content="width=device-width">
	<meta name="csrf-token" content="<%= form_authenticity_token %>" />
	<meta name="csrf-param" content="authenticity_token" />

    <%= formtastic_stylesheet_link_tag %>
	<%= stylesheet_link_tag 'style', :media => "all" %>
	<%= stylesheet_link_tag @extra_stylesheet if @extra_stylesheet %>
	<%= javascript_include_tag :defaults %>

    <%- if @include_typekit -%>
    	<script type="text/javascript" src="//use.typekit.net/vjh2nav.js"></script>
    	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <% end %>

	<%- if @include_mediaelement -%>
		<%= javascript_include_tag "//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" %>
		<script>var $j = jQuery.noConflict();</script>
		<script src="/mediaelement/mediaelement-and-player.js"></script>
		<link rel="stylesheet" href="/mediaelement/mediaelementplayer.css" />
	<%- end -%>


	<%- if GOOGLE_ANALYTICS_TRACKING_ID && RAILS_ENV == 'production' -%>
		<script type="text/javascript">

		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', '<%= GOOGLE_ANALYTICS_TRACKING_ID %>']);
		  _gaq.push(['_trackPageview']);

		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

		</script>
	<%- end -%>

</head>

<body class="<%= "admin" if @current_user.try(:admin?) || @current_user.try(:person).try(:current_lead?) %> <%= controller.action_name %> <%= controller.controller_name %> <%= @current_user.try(:person).try(:type) || @audience.to_s %> <%= @body_class %>">

	<div id="header">
		<h1><%= link_to "<strong>DreamSIS</strong>", root_url %></h1>
		
		<%= link_to_function "<span><span class='icon-bar'></span><span class='icon-bar'></span><span class='icon-bar'></span></span>",
		 	"$$('body').first().toggleClassName('menu_view')", :id => "menu_expander_link" %>

		<div id="login_logout">
			<% unless @current_user.blank? || @current_user == :false %>
				<%= image_tag(@current_user.person.avatar_image_url, :height => 30, :class => "avatar") if @current_user.person && @current_user.person.avatar_image_url %>
				<ul>
					<li><span class="hide_when_small">Logged in as </span><strong title="You are logged in as a <%= @current_user.person.type || "generic person" %>"><%= @current_user.fullname %></strong></li>
					<%- 
						path_hash = {}
						path_hash[:return_to_after_profile] = request.request_uri
						path_hash[:apply_extra_styles] = true if @extra_stylesheet
						path_hash[:apply_extra_footer_content] = true if @extra_footer_content
					 -%>
					<li><%= link_to "Profile", profile_path(path_hash) %></li>
					<li><%= link_to "Logout", logout_path, :class => "logout" unless @current_user.is_a?(PubcookieUser) %></li>
				</ul>
			<% else %>
				<em>Not logged in.</em>
				<%= link_to 'Login', login_path(:return_to => request.request_uri) %>
			<% end %>
		</div>

	</div>

	<%= render :partial => "shared/nav" if @current_user.try(:admin?) || @current_user.try(:person).try(:current_lead?) %>
	
	<div id="sidebar-header">
		<%= link_to_function "<span>Show Sidebar</span>", "$$('body').first().toggleClassName('sidebar_view')", :id => "sidebar_expander_link" %>
	</div>

	<div id="content">	

		<div id="notifications">
			<% %w(error notice info saved).each do |key| -%>
				<div id="<%= key %>_notification" class="alert <%= key %> <%= "visible" unless flash[key.to_sym].blank? %>" onClick="if(this.hasClassName('visible')) { this.toggleClassName('visible'); }"><%=h flash[key.to_sym] %></div>
			<% end -%>
		</div>

		<div id="content-wrap" class="<%= "blocked" if @layout_in_blocks %>">
			<%= yield %>
			
			<%- unless @extra_footer_content.blank? -%>
				<div class="event-footer-content extra-footer-content">
					<%= sanitize textilize(@extra_footer_content), 
											:tags => %w(table tr td h2 p a ul li strong em img), 
											:attributes => %w(id class style href src) %>
				</div>
			<% end -%>
		</div>

		<div id="footer">
			Copyright &copy; 2006&ndash;<%= Time.now.year %> 
			<%= link_to "University of Washington Dream Project", "http://www.dreamproject.uw.edu", :target => "_blank" %>.

			Student data provided in this system are protected by 
			<%= link_to "FERPA", "http://www.washington.edu/students/reg/ferpafac.html", :target => "_blank" %>.
			You are expected to understand and abide by these protections.

			Errors &amp; Exceptions tracked by <%= link_to "Exceptional", "http://exceptional.io/", :target	=> "_blank" %>. 
		</div>

		<%- if RAILS_ENV == 'development' -%>
		<div id="dev-inspector-container">
			<%= link_to_function "Dev", "$('dev-inspector').toggle()", :id => "dev-inspector-link" %>
			<div class="git branch <%= `git rev-parse --symbolic-full-name --abbrev-ref HEAD` %>">Branch <strong><%= `git rev-parse --symbolic-full-name --abbrev-ref HEAD` %></strong></div>
			<div class="git branch">Rails <strong><%= RAILS_GEM_VERSION %></strong></div>
			<div class="git branch">Customer <strong><%= Customer.name_label rescue nil %></strong></div>
			<div id="dev-inspector" style="display:none">
				<div class="session-info"><pre><%= session.to_yaml %></pre></div>
				<div class="session-info"><pre><%= request.env.reject{|k,v| k.include?("action_controller")}.to_yaml %></pre></div>
			</div>
		</div>
		<%- end -%>

	</div>
	
	<div id="indicator">Loading...</div>

</body>
</html>
